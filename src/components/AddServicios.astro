---
//src/components/AddServicios.astro
import { lucia } from "../auth";
import type { APIContext } from "astro";
import { db, CustomDataTable,eq,User } from "astro:db";
const { id } = Astro.params;

// Verificar si el usuario está autenticado
const sessionCookie = Astro.cookies.get(lucia.sessionCookieName);
const session = sessionCookie ? await lucia.validateSession(sessionCookie.value) : null;
const user = session?.user || null;
// Obtener los servicios personalizados de la base de datos
// Obtener el servicio desde la base de datos
const services = await db
  .select()
  .from(CustomDataTable)
  .where(eq(CustomDataTable.id, CustomDataTable.id)) // Buscar por ID
  .execute();

const bootstrapIcons = [
  'bi-house-door',
  'bi-truck',
  'bi-gear',
  'bi-bicycle',
  'bi-basket',
  'bi-bell',
  'bi-briefcase',
  'bi-calendar',
  'bi-camera',
  'bi-cart',
  'bi-cloud',
  'bi-pencil',
];

---
    <!-- Opciones adicionales si el usuario está autenticado -->
    {user ? (
      <div class="mt-6 px-4 lg:px-8">
        <h3 class="text-xl font-semibold mb-4">Acciones Disponibles</h3>
        <form
          method="POST"
          action="/api/push"
          class="flex flex-col items-start space-y-4"
        >
          <label for="customData" class="text-sm font-medium">
            Ingrese datos adicionales para enviar:
          </label>
        <input
            type="text"
            id="customData"
            name="customData"
            class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5"
            placeholder="Tipo de servicio"
            required
          />
        <input
            type="text"
            id="customTitle"
            name="customTitle"
            class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5"
            placeholder="Titulo del servicio"
            required
          />
        <input
            type="text"
            id="customDescription"
            name="customDescription"
            class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5"
            placeholder="Descripción del servicio"
            required
          />
        <label for="customIcon" class="text-sm font-medium">Selecciona un ícono:</label>
            <select
                id="customIcon"
                name="customIcon"
                class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5"
                required
            >
                <!-- Aquí estamos generando las opciones con los iconos disponibles -->
                {bootstrapIcons.map((icon) => (
                <option data-key={icon} value={icon}>
                    {icon} <i class={`bi ${icon}`}></i>
                </option>
                ))}
            </select>
          <button
            type="submit"
            class="text-white bg-pink-600 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5"
          >
            Enviar
          </button>
        </form>
      </div>
    ) : (
      <div class="mt-6 px-4 lg:px-8">
        <p class="text-sm text-gray-500">
          <a href="/signin" class="text-primary-600 hover:underline">
            Inicie sesión
          </a>{" "}
          para acceder a más funciones.
        </p>
      </div>
    )}
  </div>

  {services.length > 0 ? (
    services.map((service) => (
      <div class="md:w-3/12 px-2 mb-4 mt-3" data-key={service.id}>
        <div class="items-center text-center space-y-3">
          <i class={`bi ${service.icon} text-5xl`}></i>
          <h5 class="text-lg font-medium">{service.title}</h5>  <!-- Título del servicio -->
          <p class="text-sm font-medium opacity-75">{service.description}</p>
          
          <div class="flex justify-center space-x-4 mt-2">
            <a href={`/api/update`} class="text-blue-600 hover:underline">Editar</a>  <!-- Enlace para editar -->
            <button
             
              class="text-red-600 hover:underline"
            >
              Eliminar
            </button>
          </div>
        </div>
      </div>
    ))
  ) : (
    <p>No hay servicios disponibles.</p>
  )}
</div>
</section>
